onst express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');

const app = express();
const port = process.env.PORT || 5000;

// Middleware
app.use(cors());
app.use(bodyParser.json());

// In-memory store for users
const users = {};
console.log('Server started. User database is empty.');

// --- Signup Route ---
app.post('/api/signup', (req, res) => {
    const { login, password } = req.body;
    console.log(`[Signup Attempt] Trying to register user: ${login}`);

    if (!login || !password) {
        console.log('[Signup Failure] Login or password missing.');
        return res.status(400).json({ message: 'Login and password are required.' });
    }

    if (users[login]) {
        console.log(`[Signup Failure] User ${login} already exists.`);
        return res.status(409).json({ message: 'User already exists.' });
    }

    users[login] = { password: password };
    console.log(`[Signup Success] User ${login} registered successfully!`);
    console.log('Current users:', users); // Log the entire user object
    res.status(201).json({ message: 'User created successfully!' });
});

// --- Login Route ---
app.post('/api/login', (req, res) => {
    const { login, password } = req.body;
    console.log(`[Login Attempt] Trying to log in user: ${login}`);
    console.log('Searching in current users:', users);

    const user = users[login];

    if (user && user.password === password) {
        console.log(`[Login Success] User ${login} logged in successfully.`);
        res.status(200).json({ message: 'Login successful!', user: login });
    } else {
        console.log(`[Login Failure] Invalid credentials for user: ${login}`);
        res.status(401).json({ message: 'Invalid credentials.' });
    }
});


app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});